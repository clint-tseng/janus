<!DOCTYPE html>

<html>
<head>
  <title>collection.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="base.html">
                base.coffee
              </a>
            
              
              <a class="source" href="janus.coffee.html">
                janus.coffee.md
              </a>
            
              
              <a class="source" href="library.html">
                library.coffee
              </a>
            
              
              <a class="source" href="collection.html">
                collection.coffee
              </a>
            
              
              <a class="source" href="model.html">
                model.coffee
              </a>
            
              
              <a class="source" href="util.html">
                util.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>collection.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><strong>Collections</strong> are lists of <code>Models</code>. The base <code>Collection</code> implementation
is pretty simple; one can add and remove elements to and from it.</p>
<p><strong>Events</strong>:</p>
<ul>
<li><code>added</code>: <code>(item, idx)</code> the item that was added and its position.</li>
<li><code>removed</code>: <code>(item, idx)</code> the item that was removed and its position.</li>
</ul>
<p><strong>Member Events</strong>:</p>
<ul>
<li><code>addedTo</code>: <code>(collection, idx)</code> this collection and the member&#39;s position.</li>
<li><code>removedFrom</code>: <code>(collection, idx)</code> this collection and the member&#39;s
position.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>Base = require(<span class="string">'../core/base'</span>).Base
util = require(<span class="string">'../util/util'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Use Base for fancy eventy things.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Collection</span> <span class="keyword">extends</span> <span class="title">Base</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Declare what type we should be accepting for inclusion in this collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="property">@memberClass</span>: Model</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>We take in a list of <code>Model</code>s and optionally some options for the
Collection. Options are both for framework and implementation use.
Framework options:</p>
<ul>
<li><code>ignoreDestruction</code>: Defaults to <code>false</code>. By default, when a member is
destroyed the list will remove that child from itself. Set to false to
leave the reference.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (list = [], <span class="property">@options</span> = {}) -&gt;
    <span class="keyword">super</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Init our list, and add the items to it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.list = []
    <span class="keyword">this</span>.add(list)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Add one or more items to this collection. Optionally takes a second <code>index</code>
parameter indicating what position in the list all the items should be
spliced in at.</p>
<p><strong>Returns</strong> the added items as an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: (elems, idx = <span class="keyword">this</span>.list.length) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Normalize the argument to an array, then dump in our items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    elems = [ elems ] <span class="keyword">unless</span> util.isArray(elems)
    Array.splice.apply(<span class="keyword">this</span>.list, [ idx, <span class="number">0</span> ].concat(elems))

    <span class="keyword">for</span> elem, subidx <span class="keyword">in</span> elems</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Event on ourself for each item we added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.emit(<span class="string">'added'</span>, elem, idx + subidx)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Event on the item for each item we added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      elem.emit(<span class="string">'addedTo'</span>, <span class="keyword">this</span>, idx + subidx)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the item is ever destroyed, automatically remove it from our
collection. This behavior can be turned off with the <code>ignoreDestruction</code>
option.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.listenTo(elem, <span class="string">'destroying'</span>, =&gt; <span class="keyword">this</span>.remove(elem))

    elems</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Remove one item from the collection. Takes either an integer index
indicating the position of the element to remove, or a reference to the
element itself.</p>
<p><strong>Returns</strong> the removed member.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  remove: (which) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Normalize the argument to an integer index; bail if we got something
bizarre.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    which = <span class="keyword">this</span>.list.indexOf(which) <span class="keyword">if</span> which <span class="keyword">instanceof</span> <span class="keyword">this</span>.memberClass
    <span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">unless</span> util.isNumber(which) <span class="keyword">and</span> util &gt;= <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Actually remove the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removed = <span class="keyword">this</span>.list.splice(which, <span class="number">1</span>)[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Event on self and element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.emit(<span class="string">'removed'</span>, item, which)
    removed.emit(<span class="string">'removedFrom'</span>, <span class="keyword">this</span>, item, which)

    removed</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Removes all elements from a collection.</p>
<p><strong>Returns</strong> the removed elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeAll: -&gt;
    <span class="keyword">for</span> elem, idx <span class="keyword">in</span> <span class="keyword">this</span>.list
      <span class="keyword">this</span>.emit(<span class="string">'removed'</span>, elem, idx)
      elem.emit(<span class="string">'removedFrom'</span>, <span class="keyword">this</span>, idx)

    oldList = <span class="keyword">this</span>.list
    <span class="keyword">this</span>.list = []

    oldList</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Get an element from this collection by index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  get: (idx) -&gt; <span class="keyword">this</span>.list[idx]</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Set an index of this collection to the given member.</p>
<p>This is internally modelled as if the previous item at the index was removed
and the new one was added in succession, but without the later members of
the collection slipping around.</p>
<p><strong>Returns</strong> the replaced element, if any.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set: (idx, elem) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Removal of old element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removed = <span class="keyword">this</span>.list[idx]
    <span class="keyword">if</span> removed?
      <span class="keyword">this</span>.emit(<span class="string">'removed'</span>, removed, idx) 
      removed.emit(<span class="string">'removedFrom'</span>, <span class="keyword">this</span>, idx)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Adding the new element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.list[idx] = elem
    <span class="keyword">this</span>.emit(<span class="string">'added'</span>, elem, idx)
    elem.emit(<span class="string">'addedTo'</span>, <span class="keyword">this</span>, idx)

    removed

util.extend module.exports,
  Collection: Collection</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
